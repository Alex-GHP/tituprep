# TituPrep

A practice platform for final-year exams, built for **Computer Science students at "Titu Maiorescu" University** — class of 2023–2026.

TituPrep provides timed practice tests, subject-based training, a leaderboard with a daily streak system, and bilingual support (Romanian / English).

## Table of Contents

- [Tech Stack](#tech-stack)
- [Prerequisites](#prerequisites)
- [Local Setup](#local-setup)
  - [1. Clone the Repository](#1-clone-the-repository)
  - [2. Install Dependencies](#2-install-dependencies)
  - [3. Set Up Supabase](#3-set-up-supabase)
  - [4. Environment Variables](#4-environment-variables)
  - [5. Run Migrations](#5-run-migrations)
  - [6. Seed the Database](#6-seed-the-database)
  - [7. Start the Dev Server](#7-start-the-dev-server)
- [Project Structure](#project-structure)
- [Available Scripts](#available-scripts)
- [Contributing](#contributing)
  - [Reporting a Bug](#reporting-a-bug)
  - [Proposing a Feature](#proposing-a-feature)
  - [Submitting a Pull Request](#submitting-a-pull-request)
- [Code Conventions](#code-conventions)
- [CI / Pipeline](#ci--pipeline)

---

## Tech Stack

| Category | Technology |
|----------|------------|
| **Framework** | [Next.js 16](https://nextjs.org/) (App Router, React 19) |
| **Language** | TypeScript |
| **Styling** | Tailwind CSS, shadcn/ui |
| **Backend / DB** | [Supabase](https://supabase.com/) (PostgreSQL, Auth, RLS) |
| **Authentication** | GitHub OAuth (via Supabase Auth) |
| **Linting & Formatting** | [Biome](https://biomejs.dev/) |
| **Testing** | [Vitest](https://vitest.dev/) |
| **Package Manager** | [pnpm](https://pnpm.io/) |
| **Hosting** | [Vercel](https://vercel.com/) |

---

## Prerequisites

Make sure you have the following installed:

- **Node.js** ≥ 22 — [download here](https://nodejs.org/)
- **pnpm** ≥ 10 — install with: `npm install -g pnpm`
- **Git** — [download here](https://git-scm.com/)
- A **GitHub** account (required for OAuth authentication)
- A **Supabase** account (free tier) — [supabase.com](https://supabase.com/)

---

## Local Setup

### 1. Clone the Repository

```bash
git clone https://github.com/Alex-GHP/tituprep.git
cd tituprep
```

### 2. Install Dependencies

```bash
pnpm install
```

### 3. Set Up Supabase

#### a) Create a Supabase Project

1. Go to [app.supabase.com](https://app.supabase.com/) and create a new project.
2. Note down the **Project URL** and **anon (public) key** from _Settings → API_.
3. Also note the **service_role key** (in the _service_role_ section on the same page) — this is only needed for seeding.

#### b) Configure GitHub OAuth

1. In the Supabase Dashboard, go to **Authentication → Providers → GitHub**.
2. Enable the GitHub provider.
3. Copy the **Callback URL** displayed by Supabase.
4. On GitHub, go to **Settings → Developer settings → OAuth Apps → New OAuth App**:
   - **Application name**: `TituPrep Local` (or any name you prefer)
   - **Homepage URL**: `http://localhost:3000`
   - **Authorization callback URL**: paste the callback URL copied from Supabase
5. Copy the **Client ID** and **Client Secret** generated by GitHub.
6. Back in Supabase, paste the **Client ID** and **Client Secret** into the GitHub Provider section.
7. In **Authentication → URL Configuration**:
   - **Site URL**: `http://localhost:3000`
   - **Redirect URLs**: add `http://localhost:3000/**`

### 4. Environment Variables

Create a `.env.local` file in the project root:

```bash
cp .env.example .env.local
```

Then fill it in with your Supabase values:

```env
NEXT_PUBLIC_SUPABASE_URL=https://xxxxxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=eyJhbGciOi...
SUPABASE_SERVICE_ROLE_KEY=eyJhbGciOi...
```

> **Warning:** Never commit the `.env.local` file to the repository. It is already included in `.gitignore`.

### 5. Run Migrations

The SQL migrations are located in `supabase/migrations/`. They must be run **in order** using the SQL Editor in the Supabase Dashboard:

1. Go to **SQL Editor** in the Supabase Dashboard.
2. Run each file in order:
   - `001_initial_schema.sql` — tables, RLS policies, auto-create profile trigger
   - `002_leaderboard_streak.sql` — streak columns, leaderboard function
   - `003_streak_expiry.sql` — streak expiry fix for the leaderboard

> **Tip:** You can copy the contents of each file and paste them directly into the SQL Editor, then click _Run_.

### 6. Seed the Database

After the migrations have been applied, populate the database with questions and exams:

```bash
pnpm db:seed
```

This command runs the scripts in `scripts/` in the correct order (subjects → practice exams → subject exams).

> **Note:** The seed script uses `SUPABASE_SERVICE_ROLE_KEY` to bypass RLS. Make sure this variable is correctly set in `.env.local`.

### 7. Start the Dev Server

```bash
pnpm dev
```

The app will be available at [http://localhost:3000](http://localhost:3000).

---

## Project Structure

```
tituprep/
├── app/                    # Next.js App Router (pages and API routes)
│   ├── auth/callback/      # OAuth callback route
│   ├── dashboard/          # Main page (after authentication)
│   ├── exam/[examId]/      # Exam page
│   ├── leaderboard/        # Leaderboard
│   ├── results/[attemptId]/ # Attempt results
│   ├── about/              # About page
│   ├── layout.tsx          # Root layout
│   └── page.tsx            # Landing page / dashboard redirect
├── components/             # Reusable React components
│   ├── ui/                 # shadcn/ui components
│   └── *.tsx               # App-specific components
├── lib/                    # Utilities, server actions, contexts
│   ├── supabase/           # Supabase clients (browser + server)
│   ├── actions.ts          # Server Actions (submit exam, etc.)
│   └── language-context.tsx # Language context (RO / EN)
├── data/                   # JSON files with questions and exams
├── scripts/                # Database seed scripts
├── supabase/migrations/    # SQL migrations (schema + functions)
├── __tests__/              # Unit tests (Vitest)
├── hooks/                  # Custom React hooks
├── middleware.ts           # Next.js middleware (route protection)
├── biome.json              # Biome configuration (lint + format)
├── tailwind.config.ts      # Tailwind CSS configuration
└── tsconfig.json           # TypeScript configuration
```

---

## Available Scripts

| Command | Description |
|---------|-------------|
| `pnpm dev` | Start the development server (with Turbopack) |
| `pnpm build` | Build the app for production |
| `pnpm start` | Start the production server |
| `pnpm test` | Run unit tests with Vitest |
| `pnpm test:watch` | Run tests in watch mode |
| `pnpm db:seed` | Seed the database with all data |
| `pnpm db:seed:subjects` | Seed only subjects |
| `pnpm db:seed:practice` | Seed only practice exams |
| `pnpm db:seed:questions` | Seed only subject exams |

---

## Contributing

Contributions are welcome! Here's how you can help:

### Reporting a Bug

1. Check if the bug has already been reported in [Issues](https://github.com/Alex-GHP/tituprep/issues).
2. If not, create a **New Issue** with:
   - A **clear title** describing the problem
   - **Steps to reproduce** — what needs to be done to trigger the bug
   - **Expected behavior** vs. **actual behavior**
   - **Screenshots** (if relevant)
   - **Environment** (browser, OS, localhost vs. production)

### Proposing a Feature

1. Open a **New Issue** with the `enhancement` label.
2. Describe the desired feature and why it would be useful.
3. Wait for feedback before starting implementation.

### Submitting a Pull Request

1. **Fork** the repository.
2. **Create a branch** with a descriptive name:

```bash
git checkout -b fix/bug-description
# or
git checkout -b feature/new-feature
```

3. **Make your changes** and ensure they follow the [code conventions](#code-conventions).
4. **Run the local checks** before pushing:

```bash
# Lint & Format
pnpm exec biome check .

# Tests
pnpm test

# TypeScript type check
pnpm exec tsc --noEmit
```

5. **Commit & push**:

```bash
git add .
git commit -m "fix: short description of the change"
git push origin fix/bug-description
```

6. **Open a Pull Request** on GitHub targeting the `main` branch.
7. Describe what you changed and why, and reference the related issue (if any): `Fixes #123`.

---

## Code Conventions

- **Formatter & Linter**: [Biome](https://biomejs.dev/) — configuration is in `biome.json`
  - Indentation with **tabs**
  - **Double quotes** for strings
  - Imports are organized automatically
- **Strict TypeScript**: `strict` mode is enabled — avoid `any` and use proper types
- **Import paths**: imports starting with `@/` refer to the project root (alias configured in `tsconfig.json`)
- **Components**: we use functional React components with TypeScript
- **Naming**:
  - Component files: `kebab-case.tsx` (e.g. `dashboard-page.tsx`)
  - React components: `PascalCase` (e.g. `DashboardPage`)
  - Functions and variables: `camelCase`

---

## CI / Pipeline

On every **push** or **pull request** to `main`, the CI pipeline (GitHub Actions) automatically runs 3 checks:

| Job | Command | What it checks |
|-----|---------|----------------|
| **Biome** | `pnpm exec biome check .` | Linting + code formatting |
| **Vitest** | `pnpm test` | Unit tests |
| **TypeScript** | `pnpm exec tsc --noEmit` | Type checking |

**All 3 must pass** before a PR can be merged.

> **Tip:** Run the same commands locally before pushing to avoid CI failures.
